# 电梯监控系统接口文档和技术标准

## 1. 概述

本文档定义了电梯监控系统的接口规范和技术标准，包括前端数据采集、异常数据上报、AI分析结果获取等功能的接口定义。

### 1.1 系统架构

系统采用前后端分离架构：
- 前端：Vue.js框架开发的单页面应用
- 后端：RESTful API服务
- 数据库：存储异常数据和AI分析结果
- AI服务：分析异常数据并生成诊断结果

### 1.2 数据流程

1. 前端采集电梯系统数据（本地模拟或从实际设备获取）
2. 前端检测异常数据
3. 前端将异常数据发送给后端
4. 后端存储异常数据到数据库
5. AI服务分析异常数据
6. 前端获取AI分析结果
7. 前端展示AI分析结果和警告信息

## 2. 接口规范

### 2.1 通用规范

- 基础URL：`http://[服务器地址]/api`
- 请求方法：GET, POST, PUT, DELETE
- 数据格式：JSON
- 字符编码：UTF-8
- 时间格式：ISO 8601 (YYYY-MM-DDTHH:mm:ss.sssZ)
- 认证方式：JWT (JSON Web Token)

### 2.2 状态码

| 状态码 | 描述 |
| ----- | ---- |
| 200 | 成功 |
| 201 | 创建成功 |
| 400 | 请求错误 |
| 401 | 未授权 |
| 403 | 禁止访问 |
| 404 | 资源不存在 |
| 500 | 服务器错误 |

### 2.3 响应格式

```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    // 响应数据
  }
}
```

## 3. API接口定义

### 3.1 异常数据上报

#### 请求

- URL: `/api/anomalies`
- 方法: `POST`
- 请求头:
  - `Content-Type: application/json`
  - `Authorization: Bearer <token>`

#### 请求体

```json
{
  "elevatorId": "EL-001",
  "anomalies": [
    {
      "timestamp": 1621234567890,
      "systemId": "sys-001",
      "systemName": "曳引系统",
      "type": "system",
      "status": "故障",
      "faultCode": "E001-电机过热",
      "temperature": 98.5,
      "parameters": "[{\"name\":\"电机温度\",\"value\":98.5,\"unit\":\"°C\"}]"
    },
    {
      "timestamp": 1621234567890,
      "systemId": "sys-001",
      "systemName": "曳引系统",
      "type": "parameter",
      "paramName": "电机温度",
      "paramValue": 98.5,
      "paramUnit": "°C",
      "normalRange": "≤80°C",
      "anomalyLevel": "critical"
    }
  ]
}
```

#### 响应

```json
{
  "code": 200,
  "message": "异常数据上报成功",
  "data": {
    "receivedCount": 2,
    "savedCount": 2,
    "timestamp": 1621234568000
  }
}
```

### 3.2 获取AI分析结果

#### 请求

- URL: `/api/ai-analysis/:elevatorId`
- 方法: `GET`
- 请求头:
  - `Authorization: Bearer <token>`

#### 参数

- `elevatorId`: 电梯ID
- `systemId` (可选): 系统ID，不传则获取所有系统的分析结果

#### 响应

```json
{
  "code": 200,
  "message": "获取成功",
  "data": [
    {
      "id": "ai-analysis-001",
      "timestamp": 1621234567890,
      "elevatorId": "EL-001",
      "systemId": "sys-001",
      "severity": "critical",
      "systemInfo": {
        "name": "曳引系统",
        "status": "故障"
      },
      "summary": "检测到曳引机轴承温度异常波动，可能存在润滑不足或轴承磨损问题。",
      "details": [
        "轴承温度在过去30分钟内波动范围超过15°C",
        "振动值呈现逐步上升趋势",
        "电机电流波动超出正常范围"
      ],
      "recommendations": [
        "建议检查轴承润滑情况",
        "检测轴承是否存在异常磨损",
        "安排技术人员进行现场检查"
      ]
    }
  ]
}
```

### 3.3 获取历史异常数据

#### 请求

- URL: `/api/anomalies/:elevatorId`
- 方法: `GET`
- 请求头:
  - `Authorization: Bearer <token>`

#### 参数

- `elevatorId`: 电梯ID
- `systemId` (可选): 系统ID
- `startTime` (可选): 开始时间，ISO 8601格式
- `endTime` (可选): 结束时间，ISO 8601格式
- `page` (可选): 页码，默认1
- `pageSize` (可选): 每页记录数，默认20

#### 响应

```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "total": 100,
    "page": 1,
    "pageSize": 20,
    "items": [
      {
        "id": "anomaly-001",
        "timestamp": 1621234567890,
        "elevatorId": "EL-001",
        "systemId": "sys-001",
        "systemName": "曳引系统",
        "type": "parameter",
        "paramName": "电机温度",
        "paramValue": 98.5,
        "paramUnit": "°C",
        "normalRange": "≤80°C",
        "anomalyLevel": "critical"
      }
      // 更多记录...
    ]
  }
}
```

## 4. 数据模型

### 4.1 异常数据模型

```json
{
  "id": "String", // 唯一标识
  "timestamp": "Number", // 时间戳
  "elevatorId": "String", // 电梯ID
  "systemId": "String", // 系统ID
  "systemName": "String", // 系统名称
  "type": "String", // 异常类型: system(系统级) 或 parameter(参数级)
  
  // 系统级异常字段
  "status": "String", // 系统状态
  "faultCode": "String", // 故障代码
  "temperature": "Number", // 系统温度
  "parameters": "String", // JSON字符串，包含所有参数
  
  // 参数级异常字段
  "paramName": "String", // 参数名称
  "paramValue": "Number|String", // 参数值
  "paramUnit": "String", // 参数单位
  "normalRange": "String", // 正常范围
  "anomalyLevel": "String" // 异常级别: warning 或 critical
}
```

### 4.2 AI分析结果模型

```json
{
  "id": "String", // 唯一标识
  "timestamp": "Number", // 时间戳
  "elevatorId": "String", // 电梯ID
  "systemId": "String", // 系统ID
  "severity": "String", // 严重程度: info, warning, critical
  "systemInfo": {
    "name": "String", // 系统名称
    "status": "String" // 系统状态
  },
  "summary": "String", // 分析摘要
  "details": ["String"], // 详细分析
  "recommendations": ["String"] // 建议措施
}
```

## 5. 技术标准

### 5.1 前端数据采集标准

#### 5.1.1 采集频率

- 正常模式：5-10秒/次
- 高频模式：1-3秒/次（当检测到异常时）

#### 5.1.2 异常判定标准

| 系统 | 参数 | 正常范围 | 警告范围 | 故障范围 |
| --- | --- | ------- | ------- | ------- |
| 曳引系统 | 电机温度 | ≤80°C | 80-95°C | >95°C |
| 曳引系统 | 轴承温度 | ≤95°C | 85-95°C | >95°C |
| 曳引系统 | 振动速度 | ≤2.8 mm/s | 2.8-4.5 mm/s | >4.5 mm/s |
| 曳引系统 | 电流 | 额定值±10% | 额定值±10-15% | >额定值±15% |
| 曳引系统 | 钢丝绳磨损 | ≤10% | 8-10% | >10% |
| 曳引系统 | 断丝数 | ≤5根/股 | 5-8根/股 | >8根/股 |
| 曳引系统 | 制动间隙 | 0.5-1.0 mm | 1.0-1.5 mm | >1.5 mm |
| 导向系统 | 导轨垂直度偏差 | ≤0.5 mm/m | 0.5-1 mm/m | >1 mm/m |
| 导向系统 | 接头间隙 | ≤0.5 mm | 0.45-0.5 mm | >0.5 mm |
| 导向系统 | 导靴磨损量 | ≤2 mm | 2-3 mm | >3 mm |
| 电气控制系统 | 电压波动 | ±10%内 | ±10-15% | >±15% |
| 电气控制系统 | 电流负载 | ≤额定值 | 额定值-额定值+20% | >额定值+20% |
| 电气控制系统 | 触点电压降 | ≤50 mV | 50-100 mV | >100 mV |
| 电气控制系统 | 控制响应时间 | ≤0.5秒 | 0.5-1秒 | >1秒 |
| 门系统 | 触点电阻 | ≤0.5 Ω | 0.5-1 Ω | >1 Ω |
| 门系统 | 机械闭合深度 | ≥7 mm | 5-7 mm | <5 mm |
| 门系统 | 开关门时间 | 2-3秒 | 3-5秒 | >5秒 |

#### 5.1.3 数据上报策略

- 批量上报：累积5-10条异常数据后批量上报
- 定时上报：至少每60秒上报一次异常数据
- 严重异常：检测到严重异常（critical级别）立即上报

### 5.2 AI分析标准

#### 5.2.1 分析频率

- 定时分析：每10分钟分析一次最新数据
- 触发分析：当接收到严重异常数据时立即分析

#### 5.2.2 分析维度

- 单参数分析：分析单个参数的异常情况
- 多参数关联分析：分析多个参数之间的关联性
- 时间序列分析：分析参数随时间变化的趋势
- 故障模式匹配：将异常数据与已知故障模式匹配

#### 5.2.3 分析结果分级

- 信息（info）：提供系统运行状态信息，无需立即处理
- 警告（warning）：潜在问题，建议关注并计划维护
- 严重（critical）：严重问题，需要立即处理

### 5.3 前端展示标准

#### 5.3.1 通知展示策略

- 信息通知：右下角小提示，10秒后自动消失
- 警告通知：右上角通知，需要手动关闭
- 严重通知：模态框通知，需要确认关闭

#### 5.3.2 数据可视化标准

- 参数值颜色：
  - 正常：绿色
  - 警告：黄色
  - 故障：红色
- 趋势图：
  - 显示最近24小时数据
  - 异常点标记
  - 预警线和故障线显示

## 6. 安全标准

### 6.1 数据传输安全

- 使用HTTPS加密传输
- 敏感数据加密
- 请求签名验证

### 6.2 认证与授权

- JWT认证
- 角色权限控制
- 访问IP限制

### 6.3 数据存储安全

- 敏感数据加密存储
- 数据库访问控制
- 定期数据备份

## 7. 实施指南

### 7.1 前端实施

1. 在Dashboard.vue中集成DataCollectionService
2. 实现异常数据检测逻辑
3. 集成AIAnalysisNotification组件
4. 实现AI分析结果获取和展示

### 7.2 后端实施

1. 实现异常数据接收API
2. 实现数据存储逻辑
3. 集成AI分析服务
4. 实现分析结果查询API

### 7.3 AI服务实施

1. 开发数据预处理模块
2. 实现异常检测算法
3. 实现故障诊断模型
4. 开发结果生成服务

## 8. 测试标准

### 8.1 接口测试

- 接口功能测试
- 接口性能测试
- 接口安全测试

### 8.2 前端测试

- 组件单元测试
- 集成测试
- UI/UX测试

### 8.3 系统测试

- 端到端测试
- 负载测试
- 安全漏洞测试

## 9. 部署与维护

### 9.1 部署环境

- 开发环境
- 测试环境
- 生产环境

### 9.2 监控与告警

- 系统性能监控
- 接口可用性监控
- 异常告警机制

### 9.3 版本管理

- 语义化版本控制
- 变更日志记录
- 版本发布流程

## 10. 附录

### 10.1 错误码定义

| 错误码 | 描述 |
| ----- | ---- |
| E1001 | 参数错误 |
| E1002 | 认证失败 |
| E1003 | 权限不足 |
| E2001 | 数据库错误 |
| E3001 | AI服务错误 |

### 10.2 参数单位标准

| 参数类型 | 单位 |
| ------- | ---- |
| 温度 | °C |
| 振动 | mm/s |
| 电流 | A |
| 电压 | V |
| 时间 | s |
| 距离 | mm |
| 电阻 | Ω |
| 力矩 | N·m |

### 10.3 常见问题

1. Q: 如何处理网络中断情况下的数据采集？
   A: 数据将缓存在本地，网络恢复后自动上传。

2. Q: AI分析结果如何保证准确性？
   A: 通过大量历史数据训练，并结合专家知识库验证。

3. Q: 如何处理误报警情况？
   A: 系统提供反馈机制，用户可标记误报，AI模型将持续优化。 