# 前端角色控制功能实现说明

## 1. 功能概述

本系统实现了基于JWT的角色控制功能，支持管理员和维修人员两种角色。主要功能点如下：

1. 统一的登录界面，根据用户角色进入不同页面
2. 使用JWT进行身份验证和权限控制
3. 根据用户角色限制页面访问权限
4. 显示与用户角色相符的界面元素和功能

## 2. 技术实现

### 2.1 目录结构

```
src/
├── services/
│   └── authService.js        # 认证服务
├── config/
│   └── auth.config.js        # 认证相关配置
├── views/
│   ├── AdminLogin.vue        # 登录页面
│   └── MaintenanceWorkerDashboard.vue  # 维修人员仪表盘
└── router/
    └── index.js              # 路由配置（含权限控制）
```

### 2.2 认证服务 (authService.js)

实现了以下功能：
- 用户登录
- 保存用户信息
- 注销登录
- JWT令牌管理
- 角色权限检查
- 请求拦截器（自动添加令牌到请求头）
- 响应拦截器（处理401未授权响应）

### 2.3 路由权限控制

在路由配置中，为每个路由添加了角色权限控制：
```javascript
{
  path: '/',
  name: 'dashboard',
  component: Dashboard,
  meta: { requiresAuth: true, roles: ['admin'] }  // 只允许管理员访问
}
```

实现了全局路由守卫，根据用户角色控制页面访问：
```javascript
router.beforeEach((to, from, next) => {
  const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
  const userRole = localStorage.getItem('userRole');
  
  // 如果需要认证但没有登录，重定向到登录页面
  if (to.meta.requiresAuth && !isLoggedIn) {
    next({ name: 'admin-login' });
    return;
  }
  
  // 如果页面有角色限制，检查用户角色是否匹配
  if (to.meta.roles && to.meta.roles.length > 0) {
    if (!userRole || !to.meta.roles.includes(userRole)) {
      // 根据用户角色进行适当重定向
      if (userRole === 'maintenance') {
        next({ name: 'maintenance-dashboard' });
      } else if (userRole === 'admin') {
        next({ name: 'dashboard' });
      } else {
        next({ name: 'admin-login' });
      }
      return;
    }
  }
  
  next();
});
```

## 3. 用户流程

### 3.1 管理员流程

1. 访问登录页面
2. 使用管理员账户登录 (admin/admin123)
3. 成功后跳转到主页 (/)
4. 可访问所有系统功能

### 3.2 维修人员流程

1. 访问登录页面
2. 使用维修人员账户登录 (repair/repair123)
3. 成功后跳转到维修工作台 (/maintenance-dashboard)
4. 只能查看和处理分配给自己的维修任务

## 4. JWT令牌管理

### 4.1 令牌存储

JWT令牌存储在浏览器本地存储中：
```javascript
localStorage.setItem('token', userData.token);
```

### 4.2 请求拦截器

为每个API请求自动添加认证头：
```javascript
axios.interceptors.request.use(
  (config) => {
    const token = AuthService.getToken();
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  }
);
```

### 4.3 响应拦截器

处理认证失效情况：
```javascript
axios.interceptors.response.use(
  (response) => {
    return response;
  },
  (error) => {
    if (error.response && error.response.status === 401) {
      // 清除用户信息并跳转到登录页
      AuthService.logout();
      window.location = '/login';
    }
    return Promise.reject(error);
  }
);
```

## 5. 测试账户

系统预设了两个测试账户：

1. 管理员账户
   - 用户名: `admin`
   - 密码: `admin123`
   - 角色: `admin`

2. 维修人员账户
   - 用户名: `repair`
   - 密码: `repair123`
   - 角色: `maintenance`

## 6. 后端对接

详细的后端对接说明请参考 `docs/JWT认证集成指南.md` 文档，该文档包含了：

- API接口规范
- JWT令牌结构
- 安全要求
- 角色与权限
- 跨域配置
- 请求示例

## 7. 注意事项

1. 前端实现了模拟登录和认证功能，实际项目中应替换为真实的API调用
2. 敏感操作应在后端进行二次验证，不要仅依赖前端权限控制
3. JWT令牌应设置适当的过期时间，并考虑实现刷新机制
4. 生产环境中应使用HTTPS保护数据传输 